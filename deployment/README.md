# Развёртывание приложения
## Требования
 - Операционная система семейства Unix;
 - [python3.7](https://www.python.org/);
 - [Nginx](https://nginx.org/ru/);
 - [wkhtmltopdf](https://wkhtmltopdf.org/).
## Конфигурация
### Файлы конфигурации
Для правильной конфигурации системы в файлах `templater.service` и `tmpl.conf` следует заменить литералы формата `[XXXXXXX]` (исключения: `[Unit]`, `[Service]`, `[Install]`) на параметры, соответствующие вашей среде.

| Литерал | Значение | Пример |
|--|--|--|
| [PATH_TO_REPOSITORY] | Путь к коренному каталогу репозитория. | `/home/user/Templater` |
| [SERVER] | Доменное имя или адрес вашего сервера (сайта). | `www.mysite.net`</br>`192.168.25.12` |
| [PORT] | Порт для расположения приложения (рекомендуется значение `80`). | `80`</br>`443` |

Расположить данные файлы необходимо в соответствие с данной таблицей.

| Файл | Путь |
|--|--|
| `templater.service` | `/etc/systemd/system/` |
| `tmpl.conf` | `/etc/nginx/conf.d/` |

### Виртуальная среда
Перед запуском системы необходимо создать виртуальное окружение и установить в него соответствующие пакеты. Сделать это можно запуском shell-скрипта `create-venv.sh`. После выполнения данного скрипта в коренном каталоге репозитория создаётся папка `venv` с виртуальным окружением.
### Переменные среды
Для корректной работы системы необходимо задать переменные среды (окружения), задавать их следует в файле `venv/bin/.env`. Описание переменных представлено в следующей таблице:

| Переменная | Значение | Формат | Пример |
|--|--|--|--|
| SECRET_KEY | Секретный ключ приложения. | Строчное значение. | `w1!h!f6p#nuh4#pa$__` |
| ALLOWED_HOSTS | Список разрешённых сетвых размещений. | Строки, разделйнные запятой. | `www.mysite.net,192.168.25.12` |
| DEBUG | Запуск в отладочной конфигурации. | Значение `True` или `False` | `True`</br>`False` |
| WK_EXECUTABLE_PATH | Путь в системе к утилите wkhtmltoimage. | Строчное значение. | `/home/user/venv/bin/` |
| WK_OPTION_XVFB | Использование параметра --xvfb при запуске wkhtmltoimage. Необходимо при запуске на безмониторном сервере. | Присутствие либо отсутствие переменной среды. | - |
| DB_NAME | Название базы данных. | Строчное значение. | `templaterdb` |
| DB_USER | Имя пользователя для входа в БД. | Строчное значение. | `user` |
| DB_PASS | Пароль для выбранного пользователя. | Строчное значение. | `password123` |
| DB_HOST | Размещение БД (обычно используют стандартное значение `127.0.0.1`). | Строчное значение. | `127.0.0.1` |
| DB_PORT | Потр БД (обычно используют стандартное значение `5432`). | Строчное значение. | `5432`</br>`5433` |
| EMAIL_USER | Адрес электронной почты. | Строчное значение. | `templater@gmail.com` |
| EMAIL_PASS | Пароль (советуется установить временный) от эл. почтны. | Строчное значение. | `TemplaterApp10` |

## Управление
Непосредственно управление системой можно производить с помощью следующих shell-скриптов:

| Shell-скрипт | Функция |
|--|--|
| `start.sh` | Запуск сервиса приложения. |
| `stop.sh` | Остановка сервиса приложения. |
| `reload.sh` | Перезапуск сервиса приложения. Необходимо производить после внесения изменений. |
